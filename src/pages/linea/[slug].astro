---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Beneficios from '../../components/Beneficios.astro';
import LineaProductos from '../../components/LineaProductos.vue';
import { getProductos } from '../../lib/api.js';
import { lineas } from '../../lib/lineas.js';

const { slug } = Astro.params;

const linea = lineas.find((a) => a.slug == slug);

const productosFltr = {
    produccion_tipo: { op: 'Es', val: linea?.id },
};
const productos = await getProductos(productosFltr, ['categoria1']);

const categorias = [];
for (const a of productos) {
    const i = categorias.findIndex((b) => b.id == a.categoria);
    if (i === -1) {
        categorias.push(a.categoria1);
    }
}
---

<BaseLayout title={`${linea?.nombre}`}>
    <div
        class="mx-auto px-6 py-8 flex flex-col md:flex-row justify-between items-start gap-8 md:gap-16"
    >
        <h1 class="text-3xl md:text-4xl font-semibold">
            {linea?.nombre}
        </h1>
        <p class="max-w-xl">{linea?.descripcion}</p>
    </div>

    <LineaProductos client:load productos={productos} categorias={categorias} />

    <Beneficios />
</BaseLayout>
