---
import BaseLayout from '../layouts/BaseLayout.astro';
import BlendForm from '../components/BlendForm.vue';
import Beneficios from '../components/Beneficios.astro';
import { get, formatProductos } from '../lib/api.js';

const empaques = [
    { id: '1', nombre: 'CAJA', precio: 0.5 },
    { id: '2', nombre: 'LATA', precio: 1 },
    { id: '3', nombre: 'BOLSA', precio: 0.7 },
];

const qry1 = {
    fltr: {
        nombre: { op: 'Contiene', val: 'BLEND' },
    },
    cols: ['id', 'nombre', 'contenido_neto', 'fotos', 'unidad', 'has_fv', 'igv_afectacion'],
};

const res1 = await get('insumos', { qry: qry1 });
if (res1.code != 0) return;
const formatos = formatProductos(res1.data).sort(
    (a, b) => a.contenido_neto - b.contenido_neto
);

const qry = {
    fltr: {
        categoria: { op: 'Es', val: 'f000be66-e4b1-4334-b57a-0e356eb8c7a6' },
        is_ecommerce: { op: 'Es', val: true },
    },
    cols: ['id', 'nombre', 'precio', 'unidad', 'mp_tipo'],
};
const res = await get('insumos', { qry });
if (res.code != 0) return;

const hierbasBase = [];
const complementos = [];
const frutas = [];
const especias = [];

for (const a of res.data) {
    switch (a.mp_tipo) {
        case '1':
            hierbasBase.push(a);
            break;
        case '2':
            complementos.push(a);
            break;
        case '3':
            frutas.push(a);
            break;
        case '4':
            especias.push(a);
            break;
    }
}
---

<BaseLayout title="Crear tu Blend">
    <div class="bg-gray-50">
        <div class="max-w-6xl mx-auto px-6 py-20 text-gray-80">
            <h1
                class="text-4xl font-semibold text-gray-900 tracking-tight mb-2"
            >
                Crea tu Blend
            </h1>

            <p class="text-gray-600 mb-10">
                Personaliza tu infusi√≥n Sunka a tu gusto
            </p>

            <BlendForm
                client:load
                formatos={formatos}
                empaques={empaques}
                hierbasBase={hierbasBase}
                complementos={complementos}
                frutas={frutas}
                especias={especias}
            />
        </div>
    </div>

    <Beneficios />
</BaseLayout>
